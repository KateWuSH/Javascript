<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Type Ahead ğŸ‘€</title>
  <link rel="stylesheet" href="style.css">
</head>

<body>

  <form class="search-form">
    <input type="text" class="search" placeholder="City or State">
    <ul class="suggestions">
      <li>Filter for a city</li>
      <li>or a state</li>
    </ul>
  </form>
  <script src='https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js'></script>
  <script>
    const endpoint = 'https://gist.githubusercontent.com/Miserlou/c5cd8364bf9b2420bb29/raw/2bf258763cdddd704f8ffd3ea9a3e81d25e2c6f6/cities.json';

    // 1) å–è³‡æ–™
    // 2) ç›£è½ input
    // 3) æ‹¿è¼¸å…¥çš„å­—å»è³‡æ–™è£¡ç¯©é¸
    // 4) æŠŠç¯©é¸å‡ºä¾†çš„è³‡æ–™æ”¾å…¥ HTML

    let cities = [];

    fetch(endpoint).then(function (res) {
      // res.json().then((obj) => (cities = obj, console.log(cities)))
      res.json().then((obj) => (cities = obj))
    })

    /* 
       éµç›¤äº‹ä»¶ 
       change è¦ enter ä¹‹å¾Œæ‰æœƒè§¸ç™¼ï¼Œç„¡æ³•å³æ™‚åæ‡‰
       keydown æœƒæœ‰é‡è¤‡è§¸ç™¼çš„å•é¡Œ
    */

    let input = document.querySelector('.search');
    input.addEventListener('keyup', function () {
      // å–å¾— input è¼¸å…¥å­—`ï¼›trim ç‚ºæ¶ˆé™¤å‰å¾Œçš„ç©ºç™½
      let filter = this.value.trim();

      /* 
        æ­£å‰‡è¡¨é”å¼ï¼šå¯ç”¨æ–¼æ‰€æœ‰æ–‡æœ¬æœå°‹å’Œæ–‡æœ¬æ›¿æ›çš„æ“ä½œ
        gï¼šåŸ·è¡Œå…¨å±€é…å°
        iï¼šåŸ·è¡Œå°å¤§å°å¯«ä¸æ•æ„Ÿçš„é…å°
        matchï¼šæ˜¯æ­£å‰‡è¡¨é”å¼ä¸­ç”¨ä¾†é…å°æœå°‹å­—ä¸²çš„æ–¹æ³• 
      */

      // é…å°å­—ç¬¦
      let regexp = new RegExp(filter, 'gi')

      let filterArray = cities.filter(function (city) {
        return city.city.match(regexp) || city.state.match(regexp)
      })

      // å°‡è³‡æ–™ç”¢å‡ºè®Šæˆ HTMLã€‚map æœƒç”¢ç”Ÿä¸€å€‹æ–°çš„é™£åˆ—ï¼› foreach ä¸æœƒ
      let html = filterArray.map(function (city) {

        let cityName = city.city.replace(regexp, `<span class="h1">${filter}</span>`);

        let stateName = city.state.replace(regexp, `<span class="h1">${filter}</span>`);

        return `
          <li>
            <span class="name">${cityName}, ${stateName}</span>
            <span class="population">${parseInt(city.population).toLocaleString()}</span >
          </li >
        `;
      }).join('');

      // å°‡ HTML å¡å…¥ï¼Œè¦ç‰¹åˆ¥æ³¨æ„ innerHTML çš„ä½¿ç”¨ï¼Œå¾å¤–éƒ¨ä¾†çš„è³‡æ–™æœ€å¥½ç›¡é‡ä¸è¦ç›´æ¥å¯«å…¥ï¼Œé¿å…é­åˆ°æ”»æ“Š
      document.querySelector('.suggestions').innerHTML = html;
    });



    // Jquery ajax å–è³‡æ–™
    // $.ajax({
    //   url: endpoint
    // }).done(function (res) {
    //   cities = JSON.parse(res);
    //   console.log(cities);
    // })

  </script>
</body>

</html>