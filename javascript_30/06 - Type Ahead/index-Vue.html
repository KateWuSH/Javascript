<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Type Ahead ðŸ‘€</title>
  <link rel="stylesheet" href="style.css">
</head>

<body>

  <form class="search-form">
    <input type="text" class="search" placeholder="City or State" v-model="txt">
    <ul class="suggestions">
      <template v-if="txt && filterArry.length">
        <li v-for="city in filterArry">
          <span class="name" v-html="highLight(city)"></span>
          <span class="population">{{parseInt(city.population).toLocaleString()}}</span>
        </li>
      </template>
      <template v-else>
        <li>Filter for a city</li>
        <li>or a state</li>
      </template>

    </ul>
  </form>
  <script src='https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js'></script>
  <script src='https://cdnjs.cloudflare.com/ajax/libs/vue/2.5.17-beta.0/vue.js'></script>
  <script>
    const endpoint = 'https://gist.githubusercontent.com/Miserlou/c5cd8364bf9b2420bb29/raw/2bf258763cdddd704f8ffd3ea9a3e81d25e2c6f6/cities.json';

    /* 
       é è¨­åœ¨ vue è£¡é¢çš„æ¯å€‹ thisï¼Œéƒ½æœƒæŒ‡å‘é€™å€‹ vueï¼›è€Œç®­é ­å‡½å¼æ²’æœ‰è‡ªå·±çš„ thisï¼Œ
       æ‰€ä»¥éƒ½åªæœƒæ‹¿å¤–å±¤çš„é€™å€‹ this 
    */

    /* 
       å–®å‘ç¶å®šï¼šè³‡æ–™å‹• -> ç•«é¢å‹•
       é›™å‘ç¶å®šï¼šç•«é¢å‹• -> è³‡æ–™å‹•
       computedï¼šç”¨ä¾†è™•ç†æ¯”è¼ƒè¤‡é›œçš„è³‡æ–™ï¼Œå›  a è³‡æ–™è®Šå‹•è¦ç”¢ç”Ÿ b è³‡æ–™æ™‚ï¼Œå°±å¯ä»¥åœ¨ computed è£¡é¢é€²è¡Œ
    */

    new Vue({
      el: '.search-form',
      // ç•¶åªæœ‰ä¸€å€‹ component æ™‚ï¼Œdata: æˆ– data(){} æ²’å·®
      data: {
        cities: null,
        txt: ''
      },
      computed: {
        regexp() {
          return new RegExp(this.txt, 'gi')
        },
        filterArry() {
          return this.cities.filter(city => city.city.match(this.regexp) || city.state.match(this.regexp))
        }
      },
      methods: {
        highLight(city) {

          let cityName = city.city.replace(this.regexp, `<span class="h1">${this.txt}</span>`);

          let stateName = city.state.replace(this.regexp, `<span class="h1">${this.txt}</span>`);

          return cityName + ', ' + stateName;
        }
      },
      mounted() {
        $.ajax({ url: endpoint }).done(res => this.cities = JSON.parse(res));
      }
    })

  </script>

</body>

</html>